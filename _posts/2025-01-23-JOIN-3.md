---
title: "주문량이 많은 아이스크림들 조회하기"
description: >-
    JOIN
author: jutory
date: YYYY-MM-DD HH:MM:SS +09:00
categories: [SQL Coding Test, Programmers]
tags: [SQL]
---

## **문제**

다음은 아이스크림 가게의 상반기 주문 정보를 담은 `FIRST_HALF` 테이블과 7월의 아이스크림 주문 정보를 담은 `JULY` 테이블입니다.

> #### _FIRST_HALF 테이블_

| Column name   | Type         | Nullable | Description                |
|---------------|--------------|----------|----------------------------|
| SHIPMENT_ID   | INT(N)       | FALSE    | 출하 번호                 |
| FLAVOR        | VARCHAR(N)   | FALSE    | 아이스크림 맛             |
| TOTAL_ORDER   | INT(N)       | FALSE    | 상반기 아이스크림 총주문량 |

> #### _JULY 테이블_

| Column name   | Type         | Nullable | Description                |
|---------------|--------------|----------|----------------------------|
| SHIPMENT_ID   | INT(N)       | FALSE    | 출하 번호                 |
| FLAVOR        | VARCHAR(N)   | FALSE    | 아이스크림 맛             |
| TOTAL_ORDER   | INT(N)       | FALSE    | 7월 아이스크림 총주문량    |

- `FIRST_HALF` 테이블의 기본 키는 `FLAVOR`입니다.
- `FIRST_HALF.SHIPMENT_ID`는 `JULY.SHIPMENT_ID`의 외래 키입니다.
- `JULY` 테이블의 기본 키는 `SHIPMENT_ID`입니다.
- `JULY.FLAVOR`는 `FIRST_HALF.FLAVOR`의 외래 키입니다.
- 7월에는 같은 맛의 아이스크림이 여러 공장에서 출하되어 `SHIPMENT_ID`가 다를 수 있습니다.

<br>
- - -
## **문제 정의**

> `FIRST_HALF`와 `JULY` 테이블에서 아래 조건을 만족하는 데이터를 조회하는 SQL문을 작성하세요:
> 1. **7월 아이스크림 총 주문량과 상반기 아이스크림 총 주문량을 더한 값(TOTAL_ORDER_SUM)이 큰 순서대로 상위 3개의 맛을 조회**합니다.
> 
> 출력 컬럼:
> - 아이스크림 맛 (`FLAVOR`)
> - 합계 주문량 (`TOTAL_ORDER_SUM`)
> 
> 결과 정렬 기준:
> 합계 주문량을 기준으로 **내림차순 정렬**
> 
> 주의사항:  
> 합계 주문량이 같을 경우 정렬 순서에 대한 추가 조건은 없습니다.  
{: .prompt-info }

<br>
- - -
## **정답**

```sql
SELECT 
    F.FLAVOR
FROM 
    FIRST_HALF F
LEFT JOIN 
    JULY J 
ON 
    F.FLAVOR = J.FLAVOR
GROUP BY 
    F.FLAVOR, F.TOTAL_ORDER
ORDER BY 
    F.TOTAL_ORDER + COALESCE(SUM(J.TOTAL_ORDER), 0) DESC
FETCH FIRST 3 ROWS ONLY;  
```

<br>
- - -
## **Tip**

> 1. **상반기와 7월 주문량을 합산합니다.**  
>    - **`F.TOTAL_ORDER + COALESCE(SUM(J.TOTAL_ORDER), 0)`**: `FIRST_HALF`의 주문량과 `JULY`의 주문량 합계를 계산합니다. `COALESCE`를 사용해 7월 주문량이 없는 경우 `0`으로 처리합니다.
>
> 2. **맛별로 주문량을 그룹화합니다.**  
>    - **`GROUP BY F.FLAVOR, F.TOTAL_ORDER`**: `FLAVOR`를 기준으로 데이터를 그룹화하여 주문량 합계를 계산합니다.
>
> 3. **총 주문량 기준으로 상위 3개를 추출합니다.**  
>    - **`ORDER BY TOTAL_ORDER_SUM DESC`**: 합계 주문량을 기준으로 내림차순 정렬합니다.
>    - **`FETCH FIRST 3 ROWS ONLY`**: 상위 3개의 맛만 조회합니다. (MYSQL의 경우 LIMIT 3;)
>
> 4. **출력 컬럼을 제한합니다..**  
>    - **`SELECT F.FLAVOR`**: 결과에는 아이스크림 맛만 표시됩니다.
{: .prompt-tip }
> SQL Dialect Used: Oracle

<br>
- - -
## **Useful link**

[주문량이 많은 아이스크림들 조회하기](https://school.programmers.co.kr/learn/courses/30/lessons/133027)