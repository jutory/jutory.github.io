---
title: "상품을 구매한 회원 비율 구하기"
description: >-
    JOIN
author: jutory
date: YYYY-MM-DD HH:MM:SS +09:00
categories: [SQL Coding Test, Programmers]
tags: [SQL]
---


## **문제**

다음은 어느 의류 쇼핑몰에 가입한 회원 정보를 담은 `USER_INFO` 테이블과 온라인 상품 판매 정보를 담은 `ONLINE_SALE` 테이블입니다.

> #### _USER_INFO 테이블_

| Column name  | Type         | Nullable | Description          |
|--------------|--------------|----------|----------------------|
| USER_ID      | INTEGER      | FALSE    | 회원 ID              |
| GENDER       | TINYINT(1)   | TRUE     | 성별 (0: 남자, 1: 여자)|
| AGE          | INTEGER      | TRUE     | 나이                 |
| JOINED       | DATE         | FALSE    | 가입일               |

> #### _ONLINE_SALE 테이블_

| Column name      | Type         | Nullable | Description          |
|------------------|--------------|----------|----------------------|
| ONLINE_SALE_ID   | INTEGER      | FALSE    | 온라인 상품 판매 ID  |
| USER_ID          | INTEGER      | FALSE    | 회원 ID              |
| PRODUCT_ID       | INTEGER      | FALSE    | 상품 ID              |
| SALES_AMOUNT     | INTEGER      | FALSE    | 판매량               |
| SALES_DATE       | DATE         | FALSE    | 판매일               |

<br>
- - -
## **문제 정의**

> `USER_INFO`와 `ONLINE_SALE` 테이블에서 아래 조건을 만족하는 데이터를 조회하는 SQL문을 작성하세요:
> 1. 2021년에 가입한 전체 회원들 중 상품을 구매한 회원수와 상품을 구매한 회원의 비율을 구합니다.
> 2. 결과는 년(`YEAR`), 월(`MONTH`) 별로 출력합니다.
> 
> 출력 컬럼:
> - 년 (`YEAR`)
> - 월 (`MONTH`)
> - 상품을 구매한 회원수 (`PURCHASED_USERS`)
> - 상품을 구매한 회원 비율 (`PUCHASED_RATIO`)
> 
> 결과 정렬 기준:
> 1. 년(`YEAR`)을 기준으로 오름차순 정렬
> 2. 년이 같다면 월(`MONTH`)을 기준으로 오름차순 정렬
> 
> 주의사항:  
> - `PUCHASED_RATIO`는 소수점 두번째 자리에서 반올림합니다.  
> - SQL Dialect는 Oracle입니다.  
{: .prompt-info }

<br>
- - -
## **정답**

```sql
SELECT
    d.year,
    d.month,
    d.puchased_users,
    round(d.puchased_users / z.cnt, 1) AS PUCHASED_RATIO
FROM (
    SELECT 
        c.year, 
        TO_NUMBER(c.month) AS MONTH, 
        COUNT(c.user_id) AS PUCHASED_USERS
    FROM (
        SELECT DISTINCT 
            TO_CHAR(b.sales_date, 'yyyy') AS YEAR,
            TO_CHAR(b.sales_date, 'mm') AS MONTH,
            a.user_id
        FROM USER_INFO a
        INNER JOIN ONLINE_SALE b ON b.user_id = a.user_id
        WHERE TO_CHAR(a.joined, 'yyyy') = '2021'
    ) c
    GROUP BY c.year, c.month
) d, 
(
    SELECT COUNT(z.user_id) AS CNT
    FROM USER_INFO z
    WHERE TO_CHAR(z.joined, 'yyyy') = '2021') z
    ORDER BY d.year, d.month;  
```

<br>
- - -
## **Tip**

## **Tip**

> 1. **2021년에 가입한 회원을 필터링합니다.**  
>    - **`TO_CHAR(a.joined, 'yyyy') = '2021'`**: 회원 가입일이 2021년인 회원만 선택합니다.
>
> 2. **구매 데이터를 기준으로 DISTINCT한 회원 데이터를 수집합니다.**  
>    - **`TO_CHAR(b.sales_date, 'yyyy') AS YEAR`**와 **`TO_CHAR(b.sales_date, 'mm') AS MONTH`**: 구매 일자를 기준으로 년과 월을 추출합니다.  
>    - **`DISTINCT`**: 중복된 회원 데이터를 제거합니다.
>
> 3. **상품을 구매한 회원수를 계산합니다.**  
>    - **`COUNT(c.user_id)`**: 특정 년, 월에 구매한 회원 수를 계산합니다.
>
> 4. **전체 2021년 가입 회원 수를 계산합니다.**  
>    - **`COUNT(z.user_id)`**: 2021년에 가입한 전체 회원 수를 집계합니다.
>
> 5. **구매 비율을 계산하고 반올림합니다.**  
>    - **`ROUND(d.puchased_users / z.cnt, 1)`**: 구매 회원수를 전체 회원수로 나누어 비율을 계산하고 소수점 첫째 자리까지 반올림합니다.
{: .prompt-tip }
> SQL Dialect Used: Oracle

<br>
- - -
## **Useful link**

[상품을 구매한 회원 비율 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/131534)