---
title: "[JOIN] 특정 기간동안 대여 가능한 자동차들의 대여비용 구하기"
author: jutory
date: 2025-01-23 12:00:00 +09:00
categories: [SQL Coding Test, Programmers]
tags: [SQL]
render_with_liquid: false
---

## 문제

다음은 어느 자동차 대여 회사에서 대여 중인 자동차들의 정보를 담은 `CAR_RENTAL_COMPANY_CAR` 테이블과 자동차 대여 기록 정보를 담은 `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블, 그리고 자동차 종류별 대여 기간 종류별 할인 정책 정보를 담은 `CAR_RENTAL_COMPANY_DISCOUNT_PLAN` 테이블입니다.

### CAR_RENTAL_COMPANY_CAR 테이블

| Column name | Type          | Nullable | Description                 |
|-------------|---------------|----------|-----------------------------|
| CAR_ID      | INTEGER       | FALSE    | 자동차 ID                  |
| CAR_TYPE    | VARCHAR(255)  | FALSE    | 자동차 종류                |
| DAILY_FEE   | INTEGER       | FALSE    | 일일 대여 요금(원)         |
| OPTIONS     | VARCHAR(255)  | FALSE    | 자동차 옵션 리스트         |

자동차 종류는 `세단`, `SUV`, `승합차`, `트럭`, `리무진`이 있습니다. 자동차 옵션 리스트는 콤마(`,`)로 구분된 키워드 리스트(예: `열선시트,스마트키,주차감지센서`)로 되어 있으며, 키워드 종류는 아래와 같습니다:

- 주차감지센서
- 스마트키
- 네비게이션
- 통풍시트
- 열선시트
- 후방카메라
- 가죽시트

### CAR_RENTAL_COMPANY_RENTAL_HISTORY 테이블

| Column name | Type    | Nullable | Description         |
|-------------|---------|----------|---------------------|
| HISTORY_ID  | INTEGER | FALSE    | 자동차 대여 기록 ID |
| CAR_ID      | INTEGER | FALSE    | 자동차 ID          |
| START_DATE  | DATE    | FALSE    | 대여 시작일         |
| END_DATE    | DATE    | FALSE    | 대여 종료일         |

### CAR_RENTAL_COMPANY_DISCOUNT_PLAN 테이블

| Column name    | Type          | Nullable | Description                     |
|----------------|---------------|----------|---------------------------------|
| PLAN_ID        | INTEGER       | FALSE    | 요금 할인 정책 ID              |
| CAR_TYPE       | VARCHAR(255)  | FALSE    | 자동차 종류                    |
| DURATION_TYPE  | VARCHAR(255)  | FALSE    | 대여 기간 종류                 |
| DISCOUNT_RATE  | INTEGER       | FALSE    | 할인율(%)                      |

할인율이 적용되는 대여 기간 종류는 아래와 같습니다:

- `7일 이상`: 대여 기간이 7일 이상 30일 미만인 경우
- `30일 이상`: 대여 기간이 30일 이상 90일 미만인 경우
- `90일 이상`: 대여 기간이 90일 이상인 경우

대여 기간이 7일 미만인 경우 할인 정책이 적용되지 않습니다.

---

## 문제 정의

`CAR_RENTAL_COMPANY_CAR` 테이블, `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블, `CAR_RENTAL_COMPANY_DISCOUNT_PLAN` 테이블에서 아래 조건을 만족하는 자동차 리스트를 출력하는 SQL문을 작성하세요:

1. 자동차 종류가 `세단` 또는 `SUV`인 자동차 중
2. **2022년 11월 1일부터 2022년 11월 30일까지 대여 가능**하고
3. 30일간의 대여 금액이 **50만 원 이상, 200만 원 미만**인 자동차

출력 컬럼:
- 자동차 ID (`CAR_ID`)
- 자동차 종류 (`CAR_TYPE`)
- 대여 금액 (`FEE`)

결과 정렬 기준:
1. 대여 금액을 기준으로 내림차순 정렬
2. 대여 금액이 같을 경우 자동차 종류를 기준으로 오름차순 정렬
3. 자동차 종류까지 같을 경우 자동차 ID를 기준으로 내림차순 정렬

---

## 예시 데이터

### CAR_RENTAL_COMPANY_CAR 테이블

| CAR_ID | CAR_TYPE | DAILY_FEE | OPTIONS                          |
|--------|----------|-----------|----------------------------------|
| 1      | SUV      | 25000     | 가죽시트,열선시트,후방카메라    |
| 2      | 세단     | 14000     | 스마트키,네비게이션,열선시트    |
| 3      | 트럭     | 32000     | 주차감지센서,후방카메라,가죽시트 |
| 4      | 세단     | 12000     | 열선시트,후방카메라             |
| 5      | 세단     | 22000     | 스마트키,주차감지센서           |

### CAR_RENTAL_COMPANY_RENTAL_HISTORY 테이블

| HISTORY_ID | CAR_ID | START_DATE | END_DATE   |
|------------|--------|------------|------------|
| 1          | 1      | 2022-08-27 | 2022-09-02 |
| 2          | 1      | 2022-10-03 | 2022-10-04 |
| 3          | 2      | 2022-10-05 | 2022-10-20 |
| 4          | 2      | 2022-10-10 | 2022-11-12 |
| 5          | 3      | 2022-10-16 | 2022-10-17 |

### CAR_RENTAL_COMPANY_DISCOUNT_PLAN 테이블

| PLAN_ID | CAR_TYPE | DURATION_TYPE | DISCOUNT_RATE |
|---------|----------|---------------|---------------|
| 1       | 트럭     | 7일 이상      | 5%            |
| 2       | 트럭     | 30일 이상     | 7%            |
| 3       | 트럭     | 90일 이상     | 10%           |
| 4       | 세단     | 7일 이상      | 5%            |
| 5       | 세단     | 30일 이상     | 10%           |
| 6       | 세단     | 90일 이상     | 15%           |
| 7       | SUV      | 7일 이상      | 3%            |
| 8       | SUV      | 30일 이상     | 8%            |
| 9       | SUV      | 90일 이상     | 12%           |

---

## 계산 예시

1. 자동차 ID가 `1`인 경우:
   - 일일 대여 요금: 25,000원
   - 할인율: 8% (`SUV`, 30일 이상)
   - 총 대여 금액: `25,000 × (1 - 0.08) × 30 = 690,000원`

2. 자동차 ID가 `4`인 경우:
   - 일일 대여 요금: 12,000원
   - 할인율: 10% (`세단`, 30일 이상)
   - 총 대여 금액: `12,000 × (1 - 0.10) × 30 = 324,000원`

3. 자동차 ID가 `5`인 경우:
   - 일일 대여 요금: 22,000원
   - 할인율: 10% (`세단`, 30일 이상)
   - 총 대여 금액: `22,000 × (1 - 0.10) × 30 = 621,000원`

결과:

| CAR_ID | CAR_TYPE | FEE     |
|--------|----------|---------|
| 5      | 세단     | 690000  |
| 1      | SUV      | 621000  |

---

**주의사항:**
- `FEE`는 정수로 출력되어야 합니다.