---
title: "특정 기간동안 대여 가능한 자동차들의 대여비용 구하기"
description: >-
    JOIN
author: jutory
date: YYYY-MM-DD HH:MM:SS +09:00
categories: [SQL Coding Test, Programmers]
tags: [SQL]
---

## **문제**

다음은 어느 자동차 대여 회사에서 대여 중인 자동차들의 정보를 담은 `CAR_RENTAL_COMPANY_CAR` 테이블과 자동차 대여 기록 정보를 담은 `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블, 그리고 자동차 종류별 대여 기간 종류별 할인 정책 정보를 담은 `CAR_RENTAL_COMPANY_DISCOUNT_PLAN` 테이블입니다.

> #### _CAR_RENTAL_COMPANY_CAR 테이블_

| Column name | Type          | Nullable | Description                 |
|-------------|---------------|----------|-----------------------------|
| CAR_ID      | INTEGER       | FALSE    | 자동차 ID                  |
| CAR_TYPE    | VARCHAR(255)  | FALSE    | 자동차 종류                |
| DAILY_FEE   | INTEGER       | FALSE    | 일일 대여 요금(원)         |
| OPTIONS     | VARCHAR(255)  | FALSE    | 자동차 옵션 리스트         |

자동차 종류는 `세단`, `SUV`, `승합차`, `트럭`, `리무진`이 있습니다. 자동차 옵션 리스트는 콤마(`,`)로 구분된 키워드 리스트(예: `열선시트,스마트키,주차감지센서`)로 되어 있으며, 키워드 종류는 아래와 같습니다:
   - 주차감지센서
   - 스마트키
   - 네비게이션
   - 통풍시트
   - 열선시트
   - 후방카메라
   - 가죽시트

> #### _CAR_RENTAL_COMPANY_RENTAL_HISTORY 테이블_

| Column name | Type    | Nullable | Description         |
|-------------|---------|----------|---------------------|
| HISTORY_ID  | INTEGER | FALSE    | 자동차 대여 기록 ID |
| CAR_ID      | INTEGER | FALSE    | 자동차 ID          |
| START_DATE  | DATE    | FALSE    | 대여 시작일         |
| END_DATE    | DATE    | FALSE    | 대여 종료일         |

> #### _CAR_RENTAL_COMPANY_DISCOUNT_PLAN 테이블_

| Column name   | Type          | Nullable | Description              |
|---------------|---------------|----------|--------------------------|
| PLAN_ID       | INTEGER       | FALSE    | 요금 할인 정책 ID       |
| CAR_TYPE      | VARCHAR(255)  | FALSE    | 자동차 종류             |
| DURATION_TYPE | VARCHAR(255)  | FALSE    | 대여 기간 종류          |
| DISCOUNT_RATE | INTEGER       | FALSE    | 할인율(%)               |

할인율이 적용되는 대여 기간 종류는 아래와 같습니다:
 - `7일 이상`: 대여 기간이 7일 이상 30일 미만인 경우
 - `30일 이상`: 대여 기간이 30일 이상 90일 미만인 경우
 - `90일 이상`: 대여 기간이 90일 이상인 경우

대여 기간이 7일 미만인 경우 할인 정책이 적용되지 않습니다.

<br>
- - -
## **문제 정의**

> `CAR_RENTAL_COMPANY_CAR` 테이블, `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블, `CAR_RENTAL_COMPANY_DISCOUNT_PLAN` 테이블에서 아래 조건을 만족하는 자동차 리스트를 출력하는 SQL문을 작성하세요:
> 1. 자동차 종류가 `세단` 또는 `SUV`인 자동차 중
> 2. **2022년 11월 1일부터 2022년 11월 30일까지 대여 가능**하고
> 3. 30일간의 대여 금액이 **50만 원 이상, 200만 원 미만**인 자동차
> 
> 출력 컬럼:
> - 자동차 ID (`CAR_ID`)
> - 자동차 종류 (`CAR_TYPE`)
> - 대여 금액 (`FEE`)
> 
> 결과 정렬 기준:
> 1. 대여 금액을 기준으로 내림차순 정렬
> 2. 대여 금액이 같을 경우 자동차 종류를 기준으로 오름차순 정렬
> 3. 자동차 종류까지 같을 경우 자동차 ID를 기준으로 내림차순 정렬
> 
> 주의사항:  
> `FEE`는 정수로 출력  
{: .prompt-info }

<br>
- - -
## **정답**

```sql
SELECT 
    A.CAR_ID,  
    A.CAR_TYPE,
    A.FEE
FROM (
    SELECT 
        C.CAR_ID,
        C.CAR_TYPE,
        TRUNC(C.DAILY_FEE * (1 - (D.DISCOUNT_RATE / 100)) * 30) AS FEE
    FROM 
        CAR_RENTAL_COMPANY_CAR C
    LEFT JOIN 
        CAR_RENTAL_COMPANY_DISCOUNT_PLAN D
    ON 
        C.CAR_TYPE = D.CAR_TYPE
    WHERE 
        C.CAR_TYPE IN ('세단', 'SUV')
        AND D.DURATION_TYPE = '30일 이상'
) A
LEFT JOIN (
    SELECT 
        CAR_ID
    FROM 
        CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE 
        START_DATE <= TO_DATE('20221130', 'YYYYMMDD') -- 시작일이 20221130보다 이전이거나 같아야 함
        AND END_DATE >= TO_DATE('20221101', 'YYYYMMDD') -- 끝나는 일이 20221101보다 크거나 같아야 함
) B
ON 
    A.CAR_ID = B.CAR_ID
WHERE 
    B.CAR_ID IS NULL 
    AND A.FEE BETWEEN 500000 AND 1999999 
ORDER BY 
    A.FEE DESC,
    A.CAR_TYPE ASC, 
    A.CAR_ID DESC;  
```

<br>
- - -
## **Tip**

> 1. **주어진 날짜 범위(2022-11-01 ~ 2022-11-30)와 겹치는 렌탈 기록이 없는 차량을 선택합니다.**  
>    - **`B.CAR_ID IS NULL`**: `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블에 해당 `CAR_ID`가 존재하지 않으면, 차량이 대여 가능 상태로 간주됩니다.
>
> 2. **`CAR_TYPE`이 `'세단'` 또는 `'SUV'`인 차량만 선택합니다.**
>
> 3. **할인 요금을 계산하여 `500,000원 ~ 1,999,999원` 범위에 해당하는 차량만 반환합니다.**
{: .prompt-tip }
> SQL Dialect Used: Oracle

<br>
- - -
## **Useful link**

[특정 기간동안 대여 가능한 자동차들의 대여비용 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/157339)